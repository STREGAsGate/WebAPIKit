#!/bin/bash

# This script generates a patch file for a generated file.

if [ $# -ne 1 ]; then
    echo "Usage: $0 <module-name>"
    exit 1
fi

FILE=Sources/$1/Generated.swift
NEW_HEADER=$(cat <<EOF
--- a/$FILE
+++ b/$FILE
EOF)

cp $FILE $FILE.modified
swift run WebIDLToSwift --no-patch
git diff --no-ext-diff --no-index $FILE $FILE.modified | tail -n +5 | sed "s/^/$NEW_HEADER/" | sed 's/[[:space:]]*$//'
swift run WebIDLToSwift
rm $FILE.modified
